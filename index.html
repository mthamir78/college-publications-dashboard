<!--
College Publications Dashboard — ORCID + Scopus/Clarivate CSV merge
Single‑file front end (index.html)

Folders you will create in the repo:
  / (this file at root as index.html)
  /data/authors.json            ← generated by you once (or convert from CSV)
  /data/works_by_author.json    ← generated automatically by GitHub Action
  /data/merged_publications.json← generated automatically by GitHub Action
  /data/stats.json              ← generated automatically by GitHub Action
  /.github/workflows/update.yml ← GitHub Action (provided below)
  /scripts/fetch_orcid_and_merge.mjs  ← Node script (provided below)
  /package.json                 ← npm deps for Actions runner (provided below)

Replace the placeholders in the Action with your repo path and add ORCID secrets.
-->
<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>College of Science — Faculty Publications Explorer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#0f172a; --panel:#0b1224; --ink:#e5e7eb; --muted:#94a3b8; --brand:#22d3ee; --line:#1e293b; }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#0b1329);color:var(--ink);font:15px/1.6 Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
    header{position:sticky;top:0;background:rgba(11,18,36,.85);backdrop-filter:blur(6px);border-bottom:1px solid var(--line);z-index:10}
    .wrap{max-width:1200px;margin:0 auto;padding:18px}
    h1{margin:0;font-size:20px}
    .grid{display:grid;gap:16px}
    .pan{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));border:1px solid var(--line);border-radius:16px;padding:16px}
    .muted{color:var(--muted)}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    input,select{background:#0b1224;border:1px solid var(--line);color:var(--ink);padding:10px 12px;border-radius:12px;font:inherit}
    .badge{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--line);border-radius:999px;padding:4px 10px;font-size:12px}
    .tag{font-size:11px;border:1px solid var(--line);border-radius:8px;padding:2px 8px}
    .table{width:100%;border-collapse:separate;border-spacing:0 8px}
    .table th{text-align:left;font-size:12px;color:var(--muted);font-weight:600;padding:8px 10px}
    .tr{display:grid;grid-template-columns:200px 140px 110px 1fr 90px 90px 120px;align-items:center;background:rgba(255,255,255,.02);border:1px solid var(--line);border-radius:12px;padding:10px}
    .tr+.tr{margin-top:8px}
    .pill{border-radius:999px;border:1px solid var(--line);padding:2px 8px;font-size:12px}
    .section-title{display:flex;justify-content:space-between;align-items:center;margin:8px 0 12px}
    .kpi{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px}
    .card{background:rgba(255,255,255,.02);border:1px solid var(--line);border-radius:16px;padding:14px}
    .kpi .n{font-size:24px;font-weight:700}
    .dept{margin-top:12px}
    footer{color:var(--muted);text-align:center;padding:28px}
    .small{font-size:12px}
    @media (max-width:900px){ .tr{grid-template-columns:160px 120px 100px 1fr 70px 70px 100px} }
    @media (max-width:700px){ .tr{grid-template-columns:1fr} .table th{display:none} }
  </style>
</head>
<body>
  <header>
    <div class="wrap row" style="justify-content:space-between;align-items:center">
      <h1>Faculty Publications Explorer</h1>
      <div class="row">
        <span class="badge" id="lastUpdated">last update: …</span>
        <a class="badge" href="https://orcid.org/" target="_blank" rel="noopener">Powered by ORCID + CSV</a>
      </div>
    </div>
  </header>

  <main class="wrap grid" style="grid-template-columns: 1.2fr .8fr; align-items:start">
    <!-- Search / Author Profile Lookup -->
    <section class="pan">
      <div class="section-title">
        <h2 style="margin:0">Search Authors</h2>
        <span class="muted small">Find by name, ORCID, Scopus ID, or department</span>
      </div>
      <div class="row">
        <input id="q" placeholder="Type a name, ORCID (0000-0002-...), Scopus ID, Department…" style="min-width:280px">
        <select id="deptFilter"><option value="">All Departments</option></select>
        <select id="yearFilter"><option value="">All Years</option></select>
        <select id="publisherFilter">
          <option value="">All Publishers</option>
          <option value="Scopus">Scopus</option>
          <option value="Clarivate">Clarivate</option>
          <option value="Other">Not indexed</option>
        </select>
      </div>
      <div id="searchResults" style="margin-top:16px"></div>
    </section>

    <!-- Global Statistics -->
    <aside class="pan">
      <div class="section-title">
        <h2 style="margin:0">Statistics</h2>
        <span class="muted small">Publications by year & publisher</span>
      </div>
      <div class="kpi">
        <div class="card"><div class="muted small">Total Publications</div><div class="n" id="kpiTotal">–</div></div>
        <div class="card"><div class="muted small">Scopus</div><div class="n" id="kpiScopus">–</div></div>
        <div class="card"><div class="muted small">Clarivate</div><div class="n" id="kpiClarivate">–</div></div>
        <div class="card"><div class="muted small">Not indexed</div><div class="n" id="kpiOther">–</div></div>
      </div>
      <div class="card" style="margin-top:12px">
        <canvas id="chartYearly" height="220" aria-label="Yearly Publications"></canvas>
      </div>
    </aside>

    <!-- Directory grouped by department -->
    <section class="pan" style="grid-column:1/-1">
      <div class="section-title">
        <h2 style="margin:0">Authors by Department</h2>
        <span class="muted small">Directory with IDs & counts</span>
      </div>
      <div id="deptBlocks"></div>
    </section>
  </main>

  <footer>
    <div class="small">© College of Science. Built for GitHub Pages. Data: ORCID + Scopus/Clarivate CSV (deduplicated by DOI/title).</div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script>
  const state = { authors: [], worksByAuthor: {}, merged: [], stats: null };
  const y = new Date().getFullYear();
  for(let i=0;i<12;i++){ /* prefill years filter */ }

  async function load() {
    const [authors, works, merged, stats] = await Promise.all([
      fetch('data/authors.json').then(r=>r.json()).catch(()=>[]),
      fetch('data/works_by_author.json').then(r=>r.json()).catch(()=>({})),
      fetch('data/merged_publications.json').then(r=>r.json()).catch(()=>[]),
      fetch('data/stats.json').then(r=>r.json()).catch(()=>null),
    ]);
    state.authors = authors; state.worksByAuthor = works; state.merged = merged; state.stats = stats;
    document.getElementById('lastUpdated').textContent = 'last update: ' + (stats?.generated_at || '—');
    initFilters();
    renderDirectory();
    renderSearch();
    renderStats();
  }

  function initFilters(){
    const deptSet = new Set(state.authors.map(a=>a.department).filter(Boolean));
    const deptSel = document.getElementById('deptFilter');
    [...deptSet].sort().forEach(d=>{ const o=document.createElement('option'); o.value=d; o.textContent=d; deptSel.appendChild(o); });
    const yearSel = document.getElementById('yearFilter');
    const years = new Set(state.merged.map(p=>p.year).filter(Boolean));
    [...years].sort().forEach(yr=>{ const o=document.createElement('option'); o.value=yr; o.textContent=yr; yearSel.appendChild(o); });
    ['q','deptFilter','yearFilter','publisherFilter'].forEach(id=>document.getElementById(id).addEventListener('input', renderSearch));
  }

  function normalize(s){ return (s||'').toLowerCase(); }

  function renderSearch(){
    const q = normalize(document.getElementById('q').value);
    const dept = document.getElementById('deptFilter').value;
    const year = document.getElementById('yearFilter').value;
    const pub = document.getElementById('publisherFilter').value;

    const results = state.authors.filter(a=>{
      if(dept && a.department!==dept) return false;
      if(!q) return true;
      return [a.name,a.orcid,a.scopus_id,a.clarivate_id,a.department].some(v=>normalize(v).includes(q));
    }).map(a=>{
      const pubs = state.merged.filter(p=>p.author_orcid===a.orcid && (!year || p.year==year) && (!pub || p.source===pub));
      const bySource = {Scopus:0,Clarivate:0,Other:0}; pubs.forEach(p=>bySource[p.source]++);
      return { a, pubs, bySource };
    });

    const box = document.getElementById('searchResults');
    box.innerHTML = '';
    if(!results.length){ box.innerHTML = '<div class="muted">No authors match.</div>'; return; }

    results.forEach(({a, pubs, bySource})=>{
      const el = document.createElement('div');
      el.className = 'tr';
      el.innerHTML = `
        <div><strong>${a.name||'-'}</strong><div class="muted small">${a.department||''}</div></div>
        <div><span class="pill">ORCID</span><div class="small">${a.orcid||'-'}</div></div>
        <div><span class="pill">Scopus</span><div class="small">${a.scopus_id||'-'}</div></div>
        <div class="small">${a.position||''} • ${a.degree||''}</div>
        <div><span class="tag">Scopus ${bySource.Scopus}</span></div>
        <div><span class="tag">Clarivate ${bySource.Clarivate}</span></div>
        <div><span class="tag">Not indexed ${bySource.Other}</span></div>
      `;
      box.appendChild(el);
    });
  }

  function renderDirectory(){
    const byDept = {};
    state.authors.forEach(a=>{ if(!byDept[a.department]) byDept[a.department]=[]; byDept[a.department].push(a); });
    const root = document.getElementById('deptBlocks');
    root.innerHTML='';
    Object.keys(byDept).sort().forEach(d=>{
      const list = byDept[d];
      const wrap = document.createElement('div'); wrap.className='dept';
      wrap.innerHTML = `<h3 style="margin:4px 0 8px">${d}</h3>`;
      list.sort((x,y)=>x.name.localeCompare(y.name));
      list.forEach(a=>{
        const counts = {Scopus:0,Clarivate:0,Other:0};
        state.merged.forEach(p=>{ if(p.author_orcid===a.orcid) counts[p.source]++; });
        const row = document.createElement('div'); row.className='tr';
        row.innerHTML = `
          <div><strong>${a.name}</strong><div class="muted small">${a.position||''}</div></div>
          <div><span class="pill">ORCID</span><div class="small">${a.orcid||'-'}</div></div>
          <div><span class="pill">Scopus</span><div class="small">${a.scopus_id||'-'}</div></div>
          <div class="small">${a.degree||''}</div>
          <div><span class="tag">Scopus ${counts.Scopus}</span></div>
          <div><span class="tag">Clarivate ${counts.Clarivate}</span></div>
          <div><span class="tag">Not indexed ${counts.Other}</span></div>
        `;
        wrap.appendChild(row);
      });
      root.appendChild(wrap);
    });
  }

  function renderStats(){
    if(!state.stats){ return; }
    document.getElementById('kpiTotal').textContent = state.stats.total_all;
    document.getElementById('kpiScopus').textContent = state.stats.total_by_source?.Scopus||0;
    document.getElementById('kpiClarivate').textContent = state.stats.total_by_source?.Clarivate||0;
    document.getElementById('kpiOther').textContent = state.stats.total_by_source?.Other||0;
    const ctx = document.getElementById('chartYearly');
    const years = Object.keys(state.stats.by_year||{}).sort();
    const sc = years.map(y=>state.stats.by_year[y].Scopus||0);
    const cl = years.map(y=>state.stats.by_year[y].Clarivate||0);
    const ot = years.map(y=>state.stats.by_year[y].Other||0);
    new Chart(ctx, {
      type:'line',
      data:{ labels:years, datasets:[
        { label:'Scopus', data:sc },
        { label:'Clarivate', data:cl },
        { label:'Not indexed', data:ot },
      ]},
      options:{ responsive:true, plugins:{ legend:{ position:'bottom' } }, scales:{ y:{ beginAtZero:true, ticks:{ precision:0 } } } }
    });
  }

  load();
  </script>
</body>
</html>

<!-- ===================== scripts/fetch_orcid_and_merge.mjs =====================
Node 20+ script used by GitHub Actions to:
  1) Read authors.json
  2) Fetch ORCID works for each ORCID (requires /read-public token)
  3) Load CSV exports from /data/scopus.csv and /data/clarivate.csv (optional)
  4) Normalize & deduplicate (by DOI, then by normalized title)
  5) Classify into Scopus / Clarivate / Other (not indexed)
  6) Write works_by_author.json, merged_publications.json, stats.json
-->
<script type="module" id="__orcid_script_example__">
// This is a reference copy for you. Save the same content as /scripts/fetch_orcid_and_merge.mjs
import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';
import crypto from 'crypto';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
const ROOT = path.resolve(__dirname, '..');
const DATA = path.join(ROOT, 'data');

const ORCID_CLIENT_ID = process.env.ORCID_CLIENT_ID;
const ORCID_CLIENT_SECRET = process.env.ORCID_CLIENT_SECRET;

function normalizeTitle(t){
  return (t||'')
    .toLowerCase()
    .replace(/\s+/g,' ')
    .replace(/[^\p{L}\p{N}\s]/gu,'')
    .trim();
}

async function getOrcidToken(){
  const res = await fetch('https://orcid.org/oauth/token', {
    method:'POST',
    headers:{ 'Content-Type':'application/x-www-form-urlencoded' },
    body:new URLSearchParams({
      client_id: ORCID_CLIENT_ID,
      client_secret: ORCID_CLIENT_SECRET,
      grant_type: 'client_credentials',
      scope: '/read-public'
    })
  });
  if(!res.ok){ throw new Error('ORCID token failed: '+res.status+' '+await res.text()); }
  const j = await res.json();
  return j.access_token;
}

async function fetchOrcidWorks(orcid, token){
  const url = `https://pub.orcid.org/v3.0/${orcid}/works`;
  const res = await fetch(url, { headers:{ 'Accept':'application/json', 'Authorization': `Bearer ${token}` } });
  if(!res.ok){ throw new Error(`ORCID fetch failed ${orcid}: ${res.status}`); }
  const j = await res.json();
  const groups = j.group || [];
  const items = [];
  for(const g of groups){
    const summary = (g['work-summary']||[])[0];
    if(!summary) continue;
    const title = summary?.title?.title?.value || '';
    const year = summary?.['publication-date']?.year?.value || '';
    const type = summary?.type || '';
    const putCode = summary?.['put-code'];
    const externalIds = (summary?.['external-ids']?.['external-id']||[]).map(e=>({
      type: e['external-id-type'], value: e['external-id-value']
    }));
    const doi = externalIds.find(x=>x.type==='doi')?.value || '';
    items.push({ orcid, title, year: year?Number(year):null, type, doi, putCode });
  }
  return items;
}

function readCSV(file){
  if(!fs.existsSync(file)) return [];
  const raw = fs.readFileSync(file,'utf8');
  const lines = raw.split(/\r?\n/).filter(Boolean);
  const headers = lines.shift().split(',').map(h=>h.trim());
  return lines.map(line=>{
    // naive CSV split (no quotes). For complex CSVs replace with a parser.
    const cols = line.split(',');
    const rec = {}; headers.forEach((h,i)=> rec[h]=cols[i]?.trim()||'');
    return rec;
  });
}

function hash(s){ return crypto.createHash('sha1').update(s).digest('hex'); }

async function main(){
  const token = await getOrcidToken();
  const authors = JSON.parse(fs.readFileSync(path.join(DATA,'authors.json'),'utf8'));

  // 1) Fetch ORCID works per author
  const worksByAuthor = {};
  for (const a of authors){
    if(!a.orcid) continue;
    const works = await fetchOrcidWorks(a.orcid, token);
    worksByAuthor[a.orcid] = works;
  }

  // 2) Load CSV exports
  const scopusCSV = readCSV(path.join(DATA,'scopus.csv'));    // required columns: Title, DOI, Year, Author ORCID (optional)
  const clarCSV   = readCSV(path.join(DATA,'clarivate.csv')); // required columns: Title, DOI, Year, Author ORCID (optional)

  const indexByKey = new Map();
  function addPublications(arr, source){
    for(const p of arr){
      const title = p.Title||p.title||'';
      const year  = Number(p.Year||p.year||'')||null;
      const doi   = (p.DOI||p.doi||'').toLowerCase();
      const author_orcid = p['Author ORCID']||p.author_orcid||'';
      const key = doi? `doi:${doi}` : `t:${normalizeTitle(title)}`;
      const id = hash(`${key}|${author_orcid}`);
      indexByKey.set(id, { id, title, year, doi, author_orcid, source });
    }
  }
  addPublications(scopusCSV,'Scopus');
  addPublications(clarCSV,'Clarivate');

  // 3) Fold in ORCID works -> classify as Other if not found in Scopus/Clarivate
  for(const [orcid, items] of Object.entries(worksByAuthor)){
    for(const w of items){
      const key = w.doi? `doi:${w.doi.toLowerCase()}` : `t:${normalizeTitle(w.title)}`;
      const id = hash(`${key}|${orcid}`);
      if(!indexByKey.has(id)){
        indexByKey.set(id, { id, title:w.title, year:w.year, doi:w.doi||'', author_orcid:orcid, source:'Other' });
      }
    }
  }

  const merged = [...indexByKey.values()].filter(p=>p.title);

  // 4) Stats
  const stats = { generated_at: new Date().toISOString(), total_all: merged.length, total_by_source:{}, by_year:{} };
  for(const p of merged){
    stats.total_by_source[p.source] = (stats.total_by_source[p.source]||0)+1;
    const by = stats.by_year[p.year||'Unknown'] || (stats.by_year[p.year||'Unknown']={});
    by[p.source] = (by[p.source]||0)+1;
  }

  fs.mkdirSync(DATA, { recursive:true });
  fs.writeFileSync(path.join(DATA,'works_by_author.json'), JSON.stringify(worksByAuthor,null,2));
  fs.writeFileSync(path.join(DATA,'merged_publications.json'), JSON.stringify(merged,null,2));
  fs.writeFileSync(path.join(DATA,'stats.json'), JSON.stringify(stats,null,2));
  console.log('OK: wrote data files');
}

main().catch(e=>{ console.error(e); process.exit(1); });
</script>

<!-- ===================== .github/workflows/update.yml =====================
GitHub Action to run weekly and rebuild the JSON files from ORCID + CSVs.
Place as: .github/workflows/update.yml
-->
<script type="text/plain" id="__gh_action__">
name: Update ORCID + CSV data

on:
  schedule:
    - cron: '0 2 * * 1'  # every Monday at 02:00 UTC
  workflow_dispatch: {}

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install deps
        run: |
          npm ci || npm i

      - name: Generate data via ORCID + CSV
        env:
          ORCID_CLIENT_ID: ${{ secrets.ORCID_CLIENT_ID }}
          ORCID_CLIENT_SECRET: ${{ secrets.ORCID_CLIENT_SECRET }}
        run: node scripts/fetch_orcid_and_merge.mjs

      - name: Commit & push data artifacts
        run: |
          git config user.name 'gh-actions'
          git config user.email 'actions@github.com'
          git add data/works_by_author.json data/merged_publications.json data/stats.json
          git commit -m 'chore: refresh data' || echo 'no changes'
          git push
</script>

<!-- ===================== package.json =====================
Place at repo root. We keep deps minimal (none). You can add csv-parse later.
-->
<script type="application/json" id="__package_json__">
{
  "name": "college-publications-dashboard",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "build": "node scripts/fetch_orcid_and_merge.mjs"
  },
  "dependencies": {}
}
</script>

<!-- ===================== data/authors.json (example) =====================
Create this file once (edit with your actual people). ORCID is required to auto-sync.
-->
<script type="application/json" id="__authors_json_example__">
[
  {
    "name": "Dr. Alice Example",
    "orcid": "0000-0002-1825-0097",
    "department": "Biology",
    "position": "Professor",
    "degree": "PhD",
    "scopus_id": "57212345678",
    "clarivate_id": "ABC-1234-2020"
  },
  {
    "name": "Dr. Bob Example",
    "orcid": "0000-0003-1415-9269",
    "department": "Chemistry",
    "position": "Assistant Professor",
    "degree": "PhD",
    "scopus_id": "57123456789",
    "clarivate_id": "DEF-5678-2019"
  }
]
</script>

<!-- ===================== data/scopus.csv (header example) =====================
Title,DOI,Year,Author ORCID
Antibacterial Study of X,10.1234/abcd.1,2024,0000-0002-1825-0097
...
-->

<!-- ===================== data/clarivate.csv (header example) =====================
Title,DOI,Year,Author ORCID
Synthesis of Y,10.5555/efgh.9,2023,0000-0002-1825-0097
...
-->
